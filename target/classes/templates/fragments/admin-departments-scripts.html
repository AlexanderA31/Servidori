<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <script th:fragment="scripts">
        function openAddComputerModal(data) {
            document.getElementById('addComputerDeptId').value = data.deptId;
            document.getElementById('addComputerDeptName').textContent = data.deptName;
            openModal('addComputerModal');
        }

        function openAssignPrinterModal(data) {
            document.getElementById('assignPrinterDeptId').value = data.deptId;
            document.getElementById('assignPrinterDeptName').textContent = data.deptName;
            openModal('assignPrinterModal');
        }

        function openEditDepartmentModal(data) {
            document.getElementById('editDepartmentId').value = data.deptId;
            document.getElementById('editDepartmentName').value = data.deptName;
            document.getElementById('editDepartmentDescription').value = data.deptDescription || '';
            document.getElementById('editDepartmentBuilding').value = data.deptBuilding || '';
            document.getElementById('editDepartmentLocation').value = data.deptLocation || '';
            document.getElementById('editDepartmentColor').value = data.deptColor || '#667eea';
            openModal('editDepartmentModal');
        }

        // Auto-cerrar alertas
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                setTimeout(() => {
                    alert.style.opacity = '0';
                    setTimeout(() => alert.remove(), 300);
                }, 5000);
            });

            // Inicializar filtro de edificios
            initializeBuildingFilter();
        });

        // Inicializar opciones del filtro de edificios
        function initializeBuildingFilter() {
            const buildingFilter = document.getElementById('buildingFilter');
            if (!buildingFilter) return;

            // Obtener todos los edificios únicos de la tabla
            const rows = document.querySelectorAll('.data-table tbody tr:not(.dept-expanded-row)');
            const buildings = new Set();

            rows.forEach(row => {
                // La columna de edificio está en la tercera posición (índice 2)
                const buildingCell = row.cells[2];
                if (buildingCell) {
                    const buildingText = buildingCell.textContent.trim();
                    if (buildingText && buildingText !== '--') {
                        buildings.add(buildingText);
                    }
                }
            });

            // Ordenar edificios alfabéticamente y agregar al select
            Array.from(buildings).sort().forEach(building => {
                const option = document.createElement('option');
                option.value = building;
                option.textContent = building;
                buildingFilter.appendChild(option);
            });
        }

        // Filtrar departamentos por edificio
        function filterByBuilding() {
            const selectedBuilding = document.getElementById('buildingFilter').value;
            const rows = document.querySelectorAll('.data-table tbody tr:not(.dept-expanded-row)');
            let visibleCount = 0;

            rows.forEach(row => {
                const buildingCell = row.cells[2];
                const buildingText = buildingCell ? buildingCell.textContent.trim() : '';
                const expandedRow = row.nextElementSibling;

                if (selectedBuilding === '' || buildingText === selectedBuilding) {
                    // Mostrar fila
                    row.style.display = '';
                    if (expandedRow && expandedRow.classList.contains('dept-expanded-row')) {
                        expandedRow.style.display = '';
                    }
                    visibleCount++;
                } else {
                    // Ocultar fila
                    row.style.display = 'none';
                    if (expandedRow && expandedRow.classList.contains('dept-expanded-row')) {
                        expandedRow.style.display = 'none';
                    }
                }
            });

            // Mostrar mensaje si no hay resultados
            updateEmptyState(visibleCount);
        }

        // Actualizar estado vacío cuando no hay resultados
        function updateEmptyState(visibleCount) {
            const tbody = document.querySelector('.data-table tbody');
            let emptyMessage = tbody.querySelector('.filter-empty-message');

            if (visibleCount === 0) {
                if (!emptyMessage) {
                    emptyMessage = document.createElement('tr');
                    emptyMessage.className = 'filter-empty-message';
                    emptyMessage.innerHTML = `
                        <td colspan="7" style="text-align: center; padding: 2rem; color: #666;">
                            <i class="fas fa-filter" style="font-size: 2rem; margin-bottom: 0.5rem; display: block;"></i>
                            <p>No se encontraron departamentos con el filtro seleccionado</p>
                        </td>
                    `;
                    tbody.appendChild(emptyMessage);
                }
            } else {
                if (emptyMessage) {
                    emptyMessage.remove();
                }
            }
        }
    </script>
</body>
</html>
