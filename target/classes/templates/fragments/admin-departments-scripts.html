<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <script th:fragment="scripts">
        function openAddComputerModal(data) {
            document.getElementById('addComputerDeptId').value = data.deptId;
            document.getElementById('addComputerDeptName').textContent = data.deptName;
            openModal('addComputerModal');
        }

        function openAssignPrinterModal(data) {
            document.getElementById('assignPrinterDeptId').value = data.deptId;
            document.getElementById('assignPrinterDeptName').textContent = data.deptName;
            openModal('assignPrinterModal');
        }

        function openEditDepartmentModal(data) {
            document.getElementById('editDepartmentId').value = data.deptId;
            document.getElementById('editDepartmentName').value = data.deptName;
            document.getElementById('editDepartmentDescription').value = data.deptDescription || '';
            document.getElementById('editDepartmentBuilding').value = data.deptBuilding || '';
            document.getElementById('editDepartmentLocation').value = data.deptLocation || '';
            document.getElementById('editDepartmentColor').value = data.deptColor || '#667eea';
            openModal('editDepartmentModal');
        }

        // Auto-cerrar alertas
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                setTimeout(() => {
                    alert.style.opacity = '0';
                    setTimeout(() => alert.remove(), 300);
                }, 5000);
            });

            // Inicializar filtro de edificios
            initializeBuildingFilter();
        });

        // Inicializar opciones del filtro de edificios
        function initializeBuildingFilter() {
            const buildingFilter = document.getElementById('buildingFilter');
            if (!buildingFilter) return;

            // Obtener todos los edificios únicos desde el backend
            fetch('/admin/departments/buildings')
                .then(response => response.json())
                .then(buildings => {
                    // Limpiar opciones existentes (excepto "Todos")
                    while (buildingFilter.options.length > 1) {
                        buildingFilter.remove(1);
                    }

                    // Ordenar edificios alfabéticamente y agregar al select
                    buildings.sort().forEach(building => {
                        if (building && building.trim() !== '') {
                            const option = document.createElement('option');
                            option.value = building;
                            option.textContent = building;
                            buildingFilter.appendChild(option);
                        }
                    });

                    // Seleccionar el edificio si está en la URL
                    const urlParams = new URLSearchParams(window.location.search);
                    const buildingParam = urlParams.get('building');
                    if (buildingParam) {
                        buildingFilter.value = buildingParam;
                    }
                })
                .catch(error => {
                    console.error('Error al cargar edificios:', error);
                });
        }

        // Filtrar departamentos por edificio (redirige con parámetro)
        function filterByBuilding() {
            const selectedBuilding = document.getElementById('buildingFilter').value;
            const url = new URL(window.location.href);
            
            // Resetear a la primera página al filtrar
            url.searchParams.set('page', '0');
            
            if (selectedBuilding === '') {
                // Si no hay filtro, eliminar el parámetro
                url.searchParams.delete('building');
            } else {
                // Agregar el filtro de edificio
                url.searchParams.set('building', selectedBuilding);
            }
            
            // Redirigir a la URL con el filtro
            window.location.href = url.toString();
        }


    </script>
</body>
</html>
